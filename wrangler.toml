# ReefBuddy - Cloudflare Workers Configuration
# Backend for saltwater aquarium water chemistry analysis

name = "reefbuddy"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# ES Modules format (required for modern Workers)
# Reference: https://developers.cloudflare.com/workers/

# D1 Database Binding
# Create with: npx wrangler d1 create reef-db
[[d1_databases]]
binding = "DB"
database_name = "reef-db"
database_id = "5171dac0-7584-49a2-956b-971f2516e0cd"

# KV Namespace Binding (for session tracking)
# Create with: npx wrangler kv:namespace create REEF_KV
[[kv_namespaces]]
binding = "REEF_KV"
id = "b971329ac04e4171a65cfb907da0b08f"

# Environment Variables
[vars]
ENVIRONMENT = "development"
FREE_ANALYSIS_LIMIT = "3"
CF_ACCOUNT_ID = "34fe73a21dc07a799a1ded7cc1763895"

# AI Gateway Configuration
# Route all LLM calls through Cloudflare AI Gateway for caching
[vars.AI_GATEWAY]
gateway_id = "reefbuddy-ai-gateway"
# Create gateway in Cloudflare Dashboard: https://dash.cloudflare.com/?to=/:account/ai/ai-gateway

# =============================================================================
# SECRETS REFERENCE
# Set via wrangler secret put (these are NOT stored in this file):
#
# REQUIRED:
# - ANTHROPIC_API_KEY: API key for Claude AI Gateway
#
# OPTIONAL (Apple DeviceCheck - for device attestation):
# - APPLE_KEY_ID: Key ID from Apple Developer Console (DeviceCheck key)
# - APPLE_PRIVATE_KEY: Private key in PKCS8 PEM format (DeviceCheck key)
# - APPLE_TEAM_ID: Apple Developer Team ID
#
# To enable DeviceCheck:
# 1. Create a DeviceCheck key in Apple Developer Console
# 2. Download the private key (.p8 file)
# 3. Convert to PKCS8 PEM format if needed
# 4. Set all three APPLE_* secrets
#
# Example commands:
#   wrangler secret put ANTHROPIC_API_KEY
#   wrangler secret put APPLE_KEY_ID
#   wrangler secret put APPLE_PRIVATE_KEY
#   wrangler secret put APPLE_TEAM_ID
#
# Note: DeviceCheck is optional. If not configured, device verification
# will be skipped for backward compatibility.
# =============================================================================

# Development settings
[dev]
port = 8787
local_protocol = "http"
